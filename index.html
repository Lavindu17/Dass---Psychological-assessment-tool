<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASS-21 Assessment Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f9fafb; color: #374151; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-bottom: 24px; overflow: hidden; }
        .card-header { padding: 24px; text-align: center; color: white; background-color: #2563eb; }
        .card-content { padding: 24px; }
        
        /* Mobile optimizations for main layout */
        @media (max-width: 768px) {
            .container { 
                padding: 12px; 
                max-width: 100%;
            }
            .card { 
                border-radius: 8px; 
                margin-bottom: 16px; 
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .card-header { 
                padding: 20px 16px; 
            }
            .card-content { 
                padding: 20px 16px; 
            }
        }
        h1 { font-size: 32px; font-weight: bold; margin-bottom: 8px; }
        h2 { font-size: 24px; font-weight: 600; margin-bottom: 16px; }
        h3 { font-size: 20px; font-weight: 600; margin-bottom: 12px; }
        
        /* Mobile typography optimizations */
        @media (max-width: 768px) {
            h1 { 
                font-size: 24px; 
                margin-bottom: 6px; 
                line-height: 1.2;
            }
            h2 { 
                font-size: 20px; 
                margin-bottom: 12px; 
                line-height: 1.3;
            }
            h3 { 
                font-size: 18px; 
                margin-bottom: 10px; 
                line-height: 1.3;
            }
        }
        .subtitle { font-size: 14px; margin-top: 8px; opacity: 0.9; }
        .control-group { display: flex; align-items: center; gap: 8px; justify-content: center; }
        select, button { padding: 8px 16px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background: white; cursor: pointer; }
        .question-card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; margin-bottom: 16px; background: white; min-height: 250px; }
        .question-title { font-weight: 600; margin-bottom: 16px; font-size: 18px; }
        .rating-options { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .rating-option { display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 12px; border-radius: 6px; transition: background-color 0.2s; border: 1px solid #e5e7eb;}
        .rating-option:hover { background-color: #f3f4f6; }
        .rating-option.selected { background-color: #dbeafe; border-color: #2563eb; }
        .rating-option.selected input[type="radio"] { accent-color: #2563eb; }
        .rating-option input[type="radio"] { width: 18px; height: 18px; cursor: pointer; }
        .rating-text { font-size: 16px; line-height: 1.4; }
        .action-btn { width: 100%; padding: 16px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; color: white; cursor: pointer; transition: opacity 0.2s; background-color: #2563eb; margin-top: 16px; }
        .action-btn:hover { opacity: 0.9; }
        
        /* Mobile optimizations for action buttons */
        @media (max-width: 768px) {
            .action-btn { 
                padding: 14px; 
                font-size: 15px; 
                margin-top: 12px;
                border-radius: 6px;
                min-height: 48px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
        .results { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 32px; margin-bottom: 24px; text-align: center;}
        .result-item { text-align: center; }
        .result-label { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .result-score { font-size: 48px; font-weight: bold; color: #374151; margin-bottom: 8px; }
        .severity-badge { display: inline-block; padding: 6px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; }
        .severity-normal { background-color: #dcfce7; color: #166534; } 
        .severity-mild { background-color: #fef3c7; color: #92400e; } 
        .severity-moderate { background-color: #fed7aa; color: #c2410c; } 
        .severity-severe { background-color: #fecaca; color: #dc2626; } 
        .severity-extremelySevere { background-color: #fee2e2; color: #991b1b; }
        
        /* Mobile optimizations for results */
        @media (max-width: 768px) {
            .results { 
                grid-template-columns: 1fr; 
                gap: 16px; 
                margin-bottom: 16px;
            }
            .result-item { 
                background: white; 
                border: 1px solid #e2e8f0; 
                border-radius: 8px; 
                padding: 16px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }
            .result-label { font-size: 16px; }
            .result-score { font-size: 36px; }
            .severity-badge { 
                font-size: 12px; 
                padding: 4px 12px;
                display: block;
                margin-top: 8px;
            }
        }
        .notice-card { padding: 20px; border-radius: 8px; margin-top: 16px; border: 1px solid #e5e7eb; }
        .notice-card.secondary { background-color: #dbeafe; }
        
        /* Mobile optimizations for notice cards */
        @media (max-width: 768px) {
            .notice-card { 
                padding: 16px; 
                margin-top: 12px;
                font-size: 14px;
                line-height: 1.5;
            }
            .notice-card h3 {
                font-size: 16px;
                margin-bottom: 8px;
            }
            .notice-card p {
                margin-bottom: 8px;
            }
        }
        .counselor-contact-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            margin-top: 16px;
            border: none;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        .counselor-header { 
            display: flex; 
            align-items: center; 
            margin-bottom: 16px; 
        }
        .counselor-avatar { 
            width: 60px; 
            height: 60px; 
            background: rgba(255, 255, 255, 0.2); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin-right: 16px; 
            font-size: 24px; 
            font-weight: bold; 
        }
        .counselor-info h3 { 
            margin: 0; 
            font-size: 20px; 
            font-weight: 600; 
        }
        .counselor-title { 
            font-size: 14px; 
            opacity: 0.9; 
            margin-top: 4px; 
        }
        .contact-methods { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 16px; 
            margin-top: 16px; 
        }
        .contact-item { 
            background: rgba(255, 255, 255, 0.1); 
            padding: 16px; 
            border-radius: 8px; 
            text-align: center; 
            transition: all 0.3s ease; 
            cursor: pointer; 
            backdrop-filter: blur(10px); 
        }
        .contact-item:hover { 
            background: rgba(255, 255, 255, 0.2); 
            transform: translateY(-2px); 
        }
        .contact-icon { 
            font-size: 24px; 
            margin-bottom: 8px; 
            display: block; 
        }
        .contact-label { 
            font-size: 12px; 
            opacity: 0.8; 
            margin-bottom: 4px; 
        }
        .contact-value { 
            font-size: 14px; 
            font-weight: 500; 
            word-break: break-all; 
        }
        
        /* Enhanced mobile optimizations for counselor contact */
        @media (max-width: 768px) {
            .counselor-contact-card {
                padding: 20px;
                margin-top: 12px;
                border-radius: 8px;
            }
            .counselor-header { 
                flex-direction: column; 
                text-align: center; 
                margin-bottom: 16px;
            }
            .counselor-avatar { 
                margin-right: 0; 
                margin-bottom: 12px; 
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            .counselor-info h3 {
                font-size: 18px;
            }
            .counselor-title {
                font-size: 13px;
            }
            .contact-methods { 
                grid-template-columns: 1fr; 
                gap: 12px;
                margin-top: 16px;
            }
            .contact-item {
                padding: 14px;
                border-radius: 6px;
            }
            .contact-icon {
                font-size: 20px;
                margin-bottom: 6px;
            }
            .contact-label {
                font-size: 11px;
            }
            .contact-value {
                font-size: 13px;
                word-break: break-word;
            }
        }
        .notice-card strong { font-weight: 600; }
        .hidden { display: none; }
        #language-selection, #intro-screen { text-align: center; padding: 40px 20px; }
        #language-selection .card, #intro-screen .card { max-width: 800px; margin: 0 auto; text-align: left;}
        progress { width: 100%; height: 8px; -webkit-appearance: none; appearance: none; border-radius: 4px; overflow: hidden; margin-bottom: 16px;}
        progress::-webkit-progress-bar { background-color: #e5e7eb; }
        progress::-webkit-progress-value { background-color: #2563eb; transition: width 0.3s ease-in-out; }
        /* New style for encouragement messages */
        .encouragement-message {
            padding: 12px;
            margin-bottom: 16px;
            background-color: #e0f2fe;
            color: #075985;
            border-left: 5px solid #38bdf8;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            transition: opacity 0.5s;
        }
        /* Question selector styles */
        .question-selector {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .question-selector h3 {
            margin-bottom: 16px;
            color: #374151;
            font-size: 16px;
        }
        .question-progress-info {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 12px;
            text-align: center;
        }
        .question-progress-info.incomplete {
            color: #dc2626;
            font-weight: 500;
        }
        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
            gap: 8px;
            margin-bottom: 16px;
        }
        .question-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            background: white;
            color: #6b7280;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        .question-btn:hover {
            border-color: #2563eb;
            background: #f3f4f6;
        }
        .question-btn.completed {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        .question-btn.current {
            background: #fbbf24;
            color: white;
            border-color: #f59e0b;
        }
        /* Navigation buttons */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            gap: 16px;
        }
        .nav-btn {
            padding: 12px 24px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            color: #374151;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 120px;
        }
        .nav-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .nav-btn:disabled:hover {
            background: white;
            border-color: #d1d5db;
        }
        .nav-btn.primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        .nav-btn.primary:hover {
            background: #1d4ed8;
        }
        .question-counter {
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
        }
        /* Detailed scores section */
        .detailed-scores {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
        }
        .detailed-scores h3 {
            color: #1e293b;
            margin-bottom: 16px;
            font-size: 18px;
        }
        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        .score-detail {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 16px;
            text-align: center;
        }
        .score-detail h4 {
            margin: 0 0 8px 0;
            color: #475569;
            font-size: 14px;
            font-weight: 500;
        }
        .score-detail .raw-score {
            font-size: 24px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 4px;
        }
        .score-detail .final-score {
            font-size: 12px;
            color: #64748b;
        }
        
        /* Mobile optimizations for detailed scores */
        @media (max-width: 768px) {
            .detailed-scores {
                padding: 16px;
                margin-bottom: 16px;
            }
            .detailed-scores h3 {
                font-size: 16px;
                margin-bottom: 12px;
            }
            .score-breakdown {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 16px;
            }
            .score-detail {
                padding: 12px;
            }
            .score-detail .raw-score {
                font-size: 20px;
            }
        }
        /* Scoring table styles */
        .scoring-table-container {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            overflow-x: auto;
        }
        .scoring-table-container h3 {
            margin-bottom: 16px;
            color: #1e293b;
            font-size: 18px;
        }
        .scoring-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            min-width: 400px;
        }
        .scoring-table th,
        .scoring-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .scoring-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #475569;
        }
        .scoring-table tr:hover {
            background: #f8fafc;
        }
        .severity-cell {
            font-weight: 500;
        }
        .severity-cell.normal { color: #166534; }
        .severity-cell.mild { color: #92400e; }
        .severity-cell.moderate { color: #c2410c; }
        .severity-cell.severe { color: #dc2626; }
        .severity-cell.extremely-severe { color: #991b1b; }
        
        /* Mobile optimizations for scoring table */
        @media (max-width: 768px) {
            .scoring-table-container {
                padding: 16px;
                margin-bottom: 16px;
            }
            .scoring-table-container h3 {
                font-size: 16px;
                margin-bottom: 12px;
            }
            .scoring-table {
                font-size: 12px;
                min-width: 350px;
            }
            .scoring-table th,
            .scoring-table td {
                padding: 8px 6px;
                font-size: 11px;
            }
            .scoring-table th {
                position: sticky;
                top: 0;
                background: #f8fafc;
                z-index: 10;
            }
        }
    </style>
</head>
<body>

    <div id="language-selection">
        <div class="card">
            <div class="card-header"><h1>Welcome / සාදරයෙන් පිළිගනිමු</h1></div>
            <div class="card-content" style="text-align: center;">
                <h3>Please select your language:</h3>
                <h3>කරුණාකර ඔබගේ භාෂාව තෝරන්න:</h3><br>
                <div class="control-group"><select id="initial-language-select"><option value="en">English</option><option value="si">සිංහල</option></select></div><br>
                <button class="action-btn" onclick="showIntro()">Continue / ඉදිරියට යන්න</button>
            </div>
        </div>
    </div>

    <div id="intro-screen" class="hidden">
        <div class="card">
            <div class="card-header"><h2 id="intro-title"></h2></div>
            <div class="card-content">
                <div id="dass-description" class="notice-card"></div>
                <div id="privacy-notice" class="notice-card"></div>
                <button class="action-btn" id="start-btn" onclick="beginQuestionnaire()"></button>
            </div>
        </div>
    </div>

    <div class="container hidden" id="app">
        <div class="card">
            <div class="card-header">
                <h1 id="main-title"></h1>
                <p class="subtitle" id="counselor"></p>
            </div>
        </div>
        <div id="assessment-container">
            <div class="question-selector">
                <h3 id="question-selector-title">Questions</h3>
                <div class="question-progress-info" id="question-progress-info"></div>
                <div class="question-grid" id="question-grid"></div>
            </div>
            <progress id="progress-bar" value="0" max="21"></progress>
            <div id="encouragement-container" class="encouragement-message hidden"></div>
            <div class="question-card" id="questions-container"></div>
            <div class="navigation-buttons">
                <button class="nav-btn" id="prev-btn" onclick="goToPreviousQuestion()">Previous</button>
                <div class="question-counter" id="question-counter">Question 1 of 21</div>
                <button class="nav-btn primary" id="next-btn" onclick="goToNextQuestion()">Next</button>
            </div>
        </div>
        
        <div class="card hidden" id="completion-card">
            <div class="card-header">
                <h2 id="completion-title">Assessment Complete!</h2>
            </div>
            <div class="card-content" style="text-align: center;">
                <p id="completion-message">You have successfully completed all 21 questions of the DASS-21 assessment.</p>
                <button class="action-btn" id="view-results-btn" onclick="showResults()">View Assessment Results</button>
            </div>
        </div>
        <div class="card hidden" id="results-card">
            <div class="card-header"><h2 id="results-title"></h2></div>
            <div class="card-content">
                <div class="detailed-scores">
                    <h3 id="detailed-scores-title">Detailed Score Breakdown</h3>
                    <div class="score-breakdown" id="score-breakdown"></div>
                </div>
                <div class="scoring-table-container">
                    <h3 id="scoring-table-title">DASS-21 Scoring Guidelines</h3>
                    <table class="scoring-table" id="scoring-table">
                        <thead>
                            <tr>
                                <th id="severity-header">Severity</th>
                                <th id="depression-header">Depression</th>
                                <th id="anxiety-header">Anxiety</th>
                                <th id="stress-header">Stress</th>
                            </tr>
                        </thead>
                        <tbody id="scoring-table-body">
                        </tbody>
                    </table>
                </div>
                <div class="results" id="results-container"></div>
                <div id="counselor-info" class="notice-card secondary hidden"></div>
                <div id="disclaimer-notice" class="notice-card"></div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA AND TRANSLATIONS ---
        const questions = [
            { id: 1, type: 's', en: 'I found it hard to wind down', si: 'මට විවේක ගැනීමට අපහසු විය' }, { id: 2, type: 'a', en: 'I was aware of dryness of my mouth', si: 'මගේ කට වියළි යන බව මට දැනුණු' }, { id: 3, type: 'd', en: "I couldn't seem to experience any positive feeling at all", si: 'මට කිසිම ධනාත්මක හැඟීමක් අත්විඳීමට නොහැකි විය' }, { id: 4, type: 'a', en: 'I experienced breathing difficulty (e.g. excessively rapid breathing, breathlessness in the absence of physical exertion)', si: 'මට හුස්ම ගැනීම අපහසු විය (අධික වේගයෙන් හුස්ම ගැනීම ශාරීරික වෙහෙසක් නොමැති විට හුස්ම ගැනීමේ අපහසුව)' }, { id: 5, type: 'd', en: 'I found it difficult to work up the initiative to do things', si: 'දේවල් කිරීමට මුල පිරීම අපහසුවීම' }, { id: 6, type: 's', en: 'I tended to over-react to situations', si: 'මම තත්වයන්ට අධික ලෙස ප්‍රතිචාර දක්වීමට පෙළඹුණි' }, { id: 7, type: 'a', en: 'I experienced trembling (e.g. in the hands)', si: 'මට වෙව්ලීම් අත්විඳීමට සිදු විය (උදා: අත්වල)' }, { id: 8, type: 's', en: 'I felt that I was using a lot of nervous energy', si: 'මම බොහෝ ස්නායු ශක්තියක් භාවිතා කරන බව මට හැඟුණි' }, { id: 9, type: 'a', en: 'I was worried about situations in which I might panic and make a fool of myself', si: 'මම භීතියට පත් වී මා මෝඩයෙකු බවට පත් කර ගත හැකි අවස්ථා ගැන කනස්සල්ලෙන් සිටියෙමි' }, { id: 10, type: 'd', en: 'I felt that I had nothing to look forward to', si: 'මට බලාපොරොත්තුවට කිසිමක් නැති බව මට හැඟුණි' }, { id: 11, type: 's', en: 'I found myself getting agitated', si: 'මම කලබල වන බව මට දැනුණි' }, { id: 12, type: 's', en: 'I found it difficult to relax', si: 'මට සැහැල්ලුවෙන් සිටීම අපහසු විය' }, { id: 13, type: 'd', en: 'I felt down-hearted and blue', si: 'මට අධෛර්යයය සහ නීරස දැනුණි' }, { id: 14, type: 's', en: 'I was intolerant of anything that kept me from getting on with what I was doing', si: 'මා කරමින් සිටි දේ කිරීමට බාධා කළ ඕනෑම දෙයක් ඉවසීමට මට නොහැකි විය' }, { id: 15, type: 'a', en: 'I felt I was close to panic', si: 'මට කලබල වීමට ආසන්න බව් දැනුණි' }, { id: 16, type: 'd', en: 'I was unable to become enthusiastic about anything', si: 'මට කිසිවක් ගැන උත්සාහයක් කිරීමට නොහැකි විය' }, { id: 17, type: 'd', en: "I felt I wasn't worth much as a person", si: 'පුද්ගලයෙකු ලෙස මට එතරම් වටිනාකමක් නැති බව මට හැඟුණි' }, { id: 18, 'type': 's', en: 'I felt that I was rather touchy', si: 'මම තරමක් සංවේදී බව මට හැඟුණි' }, { id: 19, type: 'a', en: 'I was aware of the action of my heart in the absence of physical exertion (e.g. sense of heart rate increase, heart missing a beat)', si: 'ශාරීරික වශයෙන් වෙහෙසක් නොමැති විට හදවතේ ක්‍රියාකාරීත්වය මට දැනුනි (හෘද ස්පන්ධන වේගය වැඩිවීම/ හදවතේ ස්පන්ධන මගහැරියාම)' }, { id: 20, type: 'a', en: 'I felt scared without any good reason', si: 'කිසිම හොඳ හේතුවක් නොමැතිව මට භයක් දැනුණි' }, { id: 21, type: 'd', en: 'I felt that life was meaningless', si: 'ජීවිතය අර්ථ විරහිත බව මට හැඟුණි' }
        ];
        const ratingScale = {
            en: [ { value: 0, label: 'Did not apply to me at all' }, { value: 1, label: 'Applied to me to some degree, or some of the time' }, { value: 2, label: 'Applied to me to a considerable degree or a good part of time' }, { value: 3, label: 'Applied to me very much or most of the time' } ],
            si: [ { value: 0, label: 'මට කිසිසේත්ම අදාළ නොවිණි' }, { value: 1, label: 'යම් ප්‍රමාණයකට, හෝ සමහර වෙලාවට මට අදාළ විය' }, { value: 2, label: 'සැලකිය යුතු ප්‍රමාණයකට හෝ බොහෝ වෙලාවක් මට අදාළ විය' }, { value: 3, label: 'බොහෝසේත්ම හෝ බොහෝ වෙලාවක් මට අදාළ විය' } ]
        };
        const translations = {
            en: {
                introTitle: 'Before you begin...',
                startBtn: 'Start Assessment',
                dassDescTitle: 'About the DASS-21',
                dassDescText: 'The Depression, Anxiety and Stress Scale - 21 (DASS-21) is a set of three self-report scales designed to measure the emotional states of depression, anxiety, and stress. It is not a diagnostic tool. For more details, you can visit the <a href="https://www.psy.unsw.edu.au/dass/" target="_blank" rel="noopener noreferrer">official DASS website</a>.',
                privacyTitle: 'Your Privacy is Protected',
                privacyText: 'This assessment is completely anonymous. Your answers are not stored, and your data is not sent anywhere. All calculations are done in your browser.',
                mainTitle: 'DASS-21 Assessment',
                counselor: 'Psychological Counselor: Sajeevan Priyantha',
                resultsTitle: 'Assessment Results',
                depression: 'Depression', anxiety: 'Anxiety', stress: 'Stress',
                counselorMessage: '<strong>Support is Available:</strong> Based on your results, it may be helpful to speak with a professional. Please consider reaching out:',
                counselorContact: `
                    <div class="counselor-contact-card">
                        <div class="counselor-header">
                            <div class="counselor-avatar">SP</div>
                            <div class="counselor-info">
                                <h3>Sajeevan Priyantha</h3>
                                <div class="counselor-title">Licensed Psychological Counselor</div>
                            </div>
                        </div>
                        <div class="contact-methods">
                            <div class="contact-item" onclick="window.open('mailto:sajeevansltas@gmail.com')">
                                <span class="contact-icon">📧</span>
                                <div class="contact-label">Email</div>
                                <div class="contact-value">sajeevansltas@gmail.com</div>
                            </div>
                            <div class="contact-item" onclick="window.open('tel:+94718000623')">
                                <span class="contact-icon">📞</span>
                                <div class="contact-label">Phone</div>
                                <div class="contact-value">071 8000 623</div>
                            </div>
                        </div>
                    </div>
                `,
                disclaimerTitle: 'Important Disclaimer',
                disclaimerText: 'The DASS-21 is a screening tool and should not be used to replace a formal clinical interview. If you are experiencing significant emotional difficulties, please contact a qualified professional.',
                severity: { normal: 'Normal', mild: 'Mild', moderate: 'Moderate', severe: 'Severe', extremelySevere: 'Extremely Severe' },
                // New encouragement messages
                encouragement: {
                    7: "You're doing great, keep going!",
                    15: "Almost there, just a few more questions left!"
                },
                // Navigation translations
                questionSelectorTitle: 'Questions',
                previous: 'Previous',
                next: 'Next',
                questionOf: 'Question',
                of: 'of',
                detailedScoresTitle: 'Your Score Breakdown',
                scoringTableTitle: 'DASS-21 Scoring Guidelines',
                severityHeader: 'Severity',
                depressionHeader: 'Depression',
                anxietyHeader: 'Anxiety',
                stressHeader: 'Stress',
                rawScore: 'Raw Score',
                finalScore: 'Final Score (×2)',
                questionsCompleted: 'Questions completed',
                questionsRemaining: 'questions remaining',
                allQuestionsCompleted: 'All questions completed!',
                completionTitle: 'Assessment Complete!',
                completionMessage: 'You have successfully completed all 21 questions of the DASS-21 assessment.',
                viewResultsBtn: 'View Assessment Results'
            },
            si: {
                introTitle: 'ඔබ ආරම්භ කිරීමට පෙර...',
                startBtn: 'තක්සේරුව අරඹන්න',
                dassDescTitle: 'DASS-21 පිළිබඳව',
                dassDescText: 'මානසික අවපීඩනය, කාංසාව සහ ආතති පරිමාණය - 21 (DASS-21) යනු මානසික අවපීඩනය, කාංසාව සහ ආතතිය යන චිත්තවේගීය තත්වයන් මැනීම සඳහා නිර්මාණය කර ඇති ස්වයං-වාර්තා පරිමාණ තුනක කට්ටලයකි. එය රෝග විනිශ්චය මෙවලමක් නොවේ. වැඩි විස්තර සඳහා, ඔබට <a href="https://www.psy.unsw.edu.au/dass/" target="_blank" rel="noopener noreferrer">නිල DASS වෙබ් අඩවියට</a> පිවිසිය හැකිය.',
                privacyTitle: 'ඔබගේ පෞද්ගලිකත්වය සුරක්ෂිතයි',
                privacyText: 'මෙම තක්සේරුව සම්පූර්ණයෙන්ම නිර්නාමිකයි. ඔබගේ පිළිතුරු ගබඩා කර නොමැති අතර, ඔබගේ දත්ත කොතැනකටවත් යවනු නොලැබේ. සියලුම ගණනය කිරීම් ඔබගේ බ්‍රවුසරයේ සිදු කෙරේ.',
                mainTitle: 'DASS-21 තක්සේරුව',
                counselor: 'මනෝ විද්‍යා උපදේශක: සජීවන් ප්‍රියන්ත',
                resultsTitle: 'තක්සේරු ප්‍රතිඵල',
                depression: 'මානසික අවපීඩනය', anxiety: 'කාංසාව', stress: 'ආතතිය',
                counselorMessage: '<strong>සහාය ලබා ගත හැක:</strong> ඔබගේ ප්‍රතිඵල මත පදනම්ව, වෘත්තිකයෙකු සමඟ කතා කිරීම ප්‍රයෝජනවත් විය හැකිය. කරුණාකර සම්බන්ධ කර ගැනීම සලකා බලන්න:',
                counselorContact: `
                    <div class="counselor-contact-card">
                        <div class="counselor-header">
                            <div class="counselor-avatar">සප්‍</div>
                            <div class="counselor-info">
                                <h3>සජීවන් ප්‍රියන්ත</h3>
                                <div class="counselor-title">බලපත්‍රලත් මනෝ විද්‍යා උපදේශක</div>
                            </div>
                        </div>
                        <div class="contact-methods">
                            <div class="contact-item" onclick="window.open('mailto:sajeevansltas@gmail.com')">
                                <span class="contact-icon">📧</span>
                                <div class="contact-label">විද්‍යුත් තැපෑල</div>
                                <div class="contact-value">sajeevansltas@gmail.com</div>
                            </div>
                            <div class="contact-item" onclick="window.open('tel:+94718000623')">
                                <span class="contact-icon">📞</span>
                                <div class="contact-label">දුරකථන</div>
                                <div class="contact-value">071 8000 623</div>
                            </div>
                        </div>
                    </div>
                `,
                disclaimerTitle: 'වැදගත් සටහන',
                disclaimerText: 'DASS-21 යනු පරීක්ෂණ මෙවලමක් වන අතර එය විධිමත් සායනික සම්මුඛ පරීක්ෂණයක් සඳහා ආදේශකයක් ලෙස භාවිතා නොකළ යුතුය. ඔබ සැලකිය යුතු චිත්තවේගීය දුෂ්කරතා අත්විඳින්නේ නම්, කරුණාකර සුදුසුකම් ලත් වෘත්තිකයෙකු අමතන්න.',
                severity: { normal: 'සාමාන්‍ය', mild: 'සීමිත', moderate: 'මධ්‍යම', severe: 'දරුණු', extremelySevere: 'අතිශය දරුණු' },
                // New encouragement messages
                encouragement: {
                    7: "ඔබ හොඳින් කරගෙන යනවා!",
                    15: "තව ප්‍රශ්න කිහිපයයි!"
                },
                // Navigation translations
                questionSelectorTitle: 'ප්‍රශ්න',
                previous: 'පෙර',
                next: 'ඊළඟ',
                questionOf: 'ප්‍රශ්නය',
                of: 'න්',
                detailedScoresTitle: 'විස්තරාත්මක ලකුණු වර්ගීකරණය',
                scoringTableTitle: 'DASS-21 ලකුණු මාර්ගෝපදේශ',
                severityHeader: 'තීව්‍රතාව',
                depressionHeader: 'මානසික අවපීඩනය',
                anxietyHeader: 'කාංසාව',
                stressHeader: 'ආතතිය',
                rawScore: 'මූලික ලකුණු',
                finalScore: 'අවසාන ලකුණු (×2)',
                questionsCompleted: 'ප්‍රශ්න සම්පූර්ණ කර ඇත',
                questionsRemaining: 'ප්‍රශ්න ඉතිරිව ඇත',
                allQuestionsCompleted: 'සියලුම ප්‍රශ්න සම්පූර්ණයි!',
                completionTitle: 'තක්සේරුව සම්පූර්ණයි!',
                completionMessage: 'ඔබ DASS-21 තක්සේරුවේ සියලුම ප්‍රශ්න 21ම සාර්ථකව සම්පූර්ණ කර ඇත.',
                viewResultsBtn: 'තක්සේරු ප්‍රතිඵල බලන්න'
            }
        };

        // --- GLOBAL STATE ---
        let currentLanguage = 'en';
        let responses = {};
        let currentQuestionIndex = 0;
        let unansweredQuestions = []; // Track unanswered questions during completion phase
        let isCompletionMode = false; // Flag to indicate we're in completion mode

        // --- APPLICATION FLOW FUNCTIONS ---
        function showIntro() {
            currentLanguage = document.getElementById('initial-language-select').value;
            const t = translations[currentLanguage];
            document.getElementById('intro-title').textContent = t.introTitle;
            document.getElementById('dass-description').innerHTML = `<strong>${t.dassDescTitle}</strong><p>${t.dassDescText}</p>`;
            document.getElementById('privacy-notice').innerHTML = `<strong>${t.privacyTitle}</strong><p>${t.privacyText}</p>`;
            document.getElementById('start-btn').textContent = t.startBtn;
            document.getElementById('language-selection').classList.add('hidden');
            document.getElementById('intro-screen').classList.remove('hidden');
        }

        function beginQuestionnaire() {
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            initializeApp();
        }

        function initializeApp() {
            const t = translations[currentLanguage];
            document.getElementById('counselor').textContent = t.counselor;
            document.getElementById('main-title').textContent = t.mainTitle;
            document.getElementById('question-selector-title').textContent = t.questionSelectorTitle;
            createQuestionSelector();
            renderCurrentQuestion();
            updateNavigationButtons();
        }

        // --- NEW: Question selector functions ---
        function createQuestionSelector() {
            const questionGrid = document.getElementById('question-grid');
            questionGrid.innerHTML = '';
            
            for (let i = 0; i < questions.length; i++) {
                const btn = document.createElement('button');
                btn.className = 'question-btn';
                btn.textContent = i + 1;
                btn.onclick = () => goToQuestion(i);
                questionGrid.appendChild(btn);
            }
        }

        function updateQuestionSelector() {
            const buttons = document.querySelectorAll('.question-btn');
            const completedCount = Object.keys(responses).length;
            const totalCount = questions.length;
            const t = translations[currentLanguage];
            
            // Update progress info
            const progressInfo = document.getElementById('question-progress-info');
            if (completedCount === totalCount) {
                progressInfo.textContent = t.allQuestionsCompleted;
                progressInfo.className = 'question-progress-info';
            } else if (isCompletionMode) {
                progressInfo.textContent = `Completing remaining questions: ${unansweredQuestions.length} left`;
                progressInfo.className = 'question-progress-info incomplete';
            } else {
                progressInfo.textContent = `${completedCount}/${totalCount} ${t.questionsCompleted} (${totalCount - completedCount} ${t.questionsRemaining})`;
                progressInfo.className = 'question-progress-info incomplete';
            }
            
            // Update button states
            buttons.forEach((btn, index) => {
                btn.className = 'question-btn';
                if (index === currentQuestionIndex) {
                    btn.className += ' current';
                } else if (responses.hasOwnProperty(index)) {
                    btn.className += ' completed';
                }
                
                // In completion mode, disable buttons for already answered questions
                if (isCompletionMode && responses.hasOwnProperty(index)) {
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                    btn.onclick = null; // Disable click
                } else {
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                    btn.onclick = () => goToQuestion(index);
                }
            });
        }

        function goToQuestion(index) {
            // Allow manual navigation only if not in completion mode or if going to an unanswered question
            if (!isCompletionMode || !responses.hasOwnProperty(index)) {
                currentQuestionIndex = index;
                renderCurrentQuestion();
                updateNavigationButtons();
            }
        }

        // --- NEW: Navigation functions ---
        function goToPreviousQuestion() {
            if (isCompletionMode) {
                // In completion mode, go to previous unanswered question
                goToPreviousUnansweredQuestion();
            } else if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderCurrentQuestion();
                updateNavigationButtons();
            }
        }

        function goToPreviousUnansweredQuestion() {
            const currentUnansweredIndex = unansweredQuestions.indexOf(currentQuestionIndex);
            if (currentUnansweredIndex > 0) {
                // Go to previous unanswered question
                currentQuestionIndex = unansweredQuestions[currentUnansweredIndex - 1];
                renderCurrentQuestion();
                updateNavigationButtons();
            }
        }

        function goToNextQuestion() {
            if (isCompletionMode) {
                // In completion mode, go to next unanswered question
                goToNextUnansweredQuestion();
            } else if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderCurrentQuestion();
                updateNavigationButtons();
            } else {
                // We've reached the end (Q21), check if all questions are answered
                if (Object.keys(responses).length === questions.length) {
                    // All questions answered, show completion card
                    showCompletionCard();
                } else {
                    // Not all questions answered, enter completion mode
                    enterCompletionMode();
                }
            }
        }

        function enterCompletionMode() {
            isCompletionMode = true;
            // Get list of unanswered questions in order
            unansweredQuestions = [];
            for (let i = 0; i < questions.length; i++) {
                if (!responses.hasOwnProperty(i)) {
                    unansweredQuestions.push(i);
                }
            }
            
            console.log('Entering completion mode. Unanswered questions:', unansweredQuestions);
            
            // Go to first unanswered question
            if (unansweredQuestions.length > 0) {
                currentQuestionIndex = unansweredQuestions[0];
                renderCurrentQuestion();
                updateNavigationButtons();
            } else {
                // No unanswered questions, show completion card
                showCompletionCard();
            }
        }

        function goToNextUnansweredQuestion() {
            const currentUnansweredIndex = unansweredQuestions.indexOf(currentQuestionIndex);
            
            if (currentUnansweredIndex !== -1 && currentUnansweredIndex < unansweredQuestions.length - 1) {
                // Go to next unanswered question
                currentQuestionIndex = unansweredQuestions[currentUnansweredIndex + 1];
                renderCurrentQuestion();
                updateNavigationButtons();
            } else {
                // We've gone through all unanswered questions, check if assessment is complete
                if (Object.keys(responses).length === questions.length) {
                    // All questions now answered
                    showCompletionCard();
                } else {
                    // Still have unanswered questions, refresh the list and continue
                    enterCompletionMode();
                }
            }
        }

        function goToFirstUnansweredQuestion() {
            // This function is now only used for manual navigation to unanswered questions
            for (let i = 0; i < questions.length; i++) {
                if (!responses.hasOwnProperty(i)) {
                    currentQuestionIndex = i;
                    renderCurrentQuestion();
                    updateNavigationButtons();
                    return;
                }
            }
        }

        function updateNavigationButtons() {
            const t = translations[currentLanguage];
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const counter = document.getElementById('question-counter');
            
            if (isCompletionMode) {
                // In completion mode, show different navigation
                const currentUnansweredIndex = unansweredQuestions.indexOf(currentQuestionIndex);
                const totalUnanswered = unansweredQuestions.length;
                
                prevBtn.disabled = currentUnansweredIndex === 0;
                prevBtn.textContent = t.previous;
                nextBtn.textContent = t.next;
                nextBtn.disabled = false;
                
                // Show completion progress
                counter.textContent = `Completing ${currentUnansweredIndex + 1} of ${totalUnanswered} remaining questions`;
            } else {
                // Normal mode navigation
                prevBtn.disabled = currentQuestionIndex === 0;
                prevBtn.textContent = t.previous;
                nextBtn.textContent = t.next;
                nextBtn.disabled = false;
                
                // Update counter
                counter.textContent = `${t.questionOf} ${currentQuestionIndex + 1} ${t.of} ${questions.length}`;
            }
        }

        // --- QUESTION & ANSWER FUNCTIONS ---
        function renderCurrentQuestion() {
            // Update question selector
            updateQuestionSelector();
            
            // Show encouragement messages
            const encouragementContainer = document.getElementById('encouragement-container');
            const t = translations[currentLanguage];
            const message = t.encouragement[currentQuestionIndex + 1];
            if (message) {
                encouragementContainer.textContent = message;
                encouragementContainer.classList.remove('hidden');
            } else {
                encouragementContainer.classList.add('hidden');
            }
            
            // Update progress bar
            const progressBar = document.getElementById('progress-bar');
            progressBar.value = Object.keys(responses).length;
            
            // Render question
            const question = questions[currentQuestionIndex];
            const questionText = `<div class="question-title">${currentQuestionIndex + 1}. ${question[currentLanguage]}</div>`;
            
            // Get current answer if exists
            const currentAnswer = responses[currentQuestionIndex];
            
            const optionsHTML = ratingScale[currentLanguage].map(rating => {
                const isSelected = currentAnswer === rating.value;
                return `<div class="rating-option ${isSelected ? 'selected' : ''}" onclick="selectRating(${rating.value})">
                    <input type="radio" name="question-${question.id}" value="${rating.value}" ${isSelected ? 'checked' : ''}>
                    <span class="rating-text">${rating.label}</span>
                </div>`;
            }).join('');
            
            document.getElementById('questions-container').innerHTML = questionText + '<div class="rating-options">' + optionsHTML + '</div>';
        }

        function selectRating(value) {
            responses[currentQuestionIndex] = value;
            
            // If in completion mode, remove this question from unanswered list
            if (isCompletionMode) {
                const index = unansweredQuestions.indexOf(currentQuestionIndex);
                if (index > -1) {
                    unansweredQuestions.splice(index, 1);
                }
                console.log('Question answered. Remaining unanswered questions:', unansweredQuestions);
            }
            
            // Update the visual selection
            const options = document.querySelectorAll('.rating-option');
            options.forEach((option, index) => {
                option.classList.remove('selected');
                if (index === value) {
                    option.classList.add('selected');
                }
            });
            
            // Update question selector and navigation
            updateQuestionSelector();
            updateNavigationButtons();
            
            // Auto-advance to next question after a short delay
            setTimeout(() => {
                if (isCompletionMode) {
                    if (Object.keys(responses).length === questions.length) {
                        // All questions now answered, show completion card
                        showCompletionCard();
                    } else {
                        // Go to next unanswered question
                        goToNextUnansweredQuestion();
                    }
                } else if (currentQuestionIndex < questions.length - 1) {
                    goToNextQuestion();
                } else {
                    // We've reached the end (Q21), check if all questions are answered
                    if (Object.keys(responses).length === questions.length) {
                        // All questions answered, show completion card
                        showCompletionCard();
                    } else {
                        // Not all questions answered, enter completion mode
                        enterCompletionMode();
                    }
                }
            }, 800); // 800ms delay for better UX
        }

        // --- NEW: Completion card functions ---
        function showCompletionCard() {
            const t = translations[currentLanguage];
            
            // Reset completion mode
            isCompletionMode = false;
            unansweredQuestions = [];
            
            // Update completion card text
            document.getElementById('completion-title').textContent = t.completionTitle;
            document.getElementById('completion-message').textContent = t.completionMessage;
            document.getElementById('view-results-btn').textContent = t.viewResultsBtn;
            
            // Hide assessment container and show completion card
            document.getElementById('assessment-container').classList.add('hidden');
            document.getElementById('completion-card').classList.remove('hidden');
            
            // Scroll to completion card
            document.getElementById('completion-card').scrollIntoView({ behavior: 'smooth' });
        }

        function showResults() {
            // Hide completion card and show results
            document.getElementById('completion-card').classList.add('hidden');
            calculateResults();
        }

        // --- RESULTS CALCULATION AND DISPLAY ---
        function calculateScores() {
            const finalScores = { depression: 0, anxiety: 0, stress: 0 };
            questions.forEach((q, index) => {
                const score = responses[index] || 0;
                if (q.type === 'd') finalScores.depression += score;
                else if (q.type === 'a') finalScores.anxiety += score;
                else if (q.type === 's') finalScores.stress += score;
            });
            finalScores.depression *= 2;
            finalScores.anxiety *= 2;
            finalScores.stress *= 2;
            return finalScores;
        }

        function getSeverityLevel(score, type) {
            const ranges = {
                depression: { normal: [0, 9], mild: [10, 13], moderate: [14, 20], severe: [21, 27], extremelySevere: [28, Infinity] },
                anxiety: { normal: [0, 7], mild: [8, 9], moderate: [10, 14], severe: [15, 19], extremelySevere: [20, Infinity] },
                stress: { normal: [0, 14], mild: [15, 18], moderate: [19, 25], severe: [26, 33], extremelySevere: [34, Infinity] }
            };
            for (const [level, [min, max]] of Object.entries(ranges[type])) {
                if (score >= min && score <= max) return level;
            }
        }

        function calculateResults() {
            const scores = calculateScores();
            const rawScores = calculateRawScores();
            const t = translations[currentLanguage];
            
            // Update results page translations
            document.getElementById('results-title').textContent = t.resultsTitle;
            document.getElementById('detailed-scores-title').textContent = t.detailedScoresTitle;
            document.getElementById('scoring-table-title').textContent = t.scoringTableTitle;
            document.getElementById('severity-header').textContent = t.severityHeader;
            document.getElementById('depression-header').textContent = t.depression;
            document.getElementById('anxiety-header').textContent = t.anxiety;
            document.getElementById('stress-header').textContent = t.stress;
            
            // Render detailed scores
            renderDetailedScores(rawScores, scores, t);
            
            // Render scoring table
            renderScoringTable(t);
            
            // Render main results
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.innerHTML = '';
            
            let showCounselorInfo = false;
            for (const type of ['depression', 'anxiety', 'stress']) {
                const score = scores[type];
                const severity = getSeverityLevel(score, type);
                if (severity !== 'normal') showCounselorInfo = true;
                resultsContainer.innerHTML += `
                    <div class="result-item">
                        <div class="result-label">${t[type]}</div>
                        <div class="result-score">${score}</div>
                        <div class="severity-badge severity-${severity}">${t.severity[severity]}</div>
                    </div>`;
            }

            if (showCounselorInfo) {
                const counselorDiv = document.getElementById('counselor-info');
                counselorDiv.innerHTML = `<p>${t.counselorMessage}</p>${t.counselorContact}`;
                counselorDiv.classList.remove('hidden');
            }

            document.getElementById('disclaimer-notice').innerHTML = `<strong>${t.disclaimerTitle}</strong><p>${t.disclaimerText}</p>`;
            document.getElementById('results-card').classList.remove('hidden');
            document.getElementById('results-card').scrollIntoView({ behavior: 'smooth' });
        }

        function calculateRawScores() {
            const rawScores = { depression: 0, anxiety: 0, stress: 0 };
            questions.forEach((q, index) => {
                const score = responses[index] || 0;
                if (q.type === 'd') rawScores.depression += score;
                else if (q.type === 'a') rawScores.anxiety += score;
                else if (q.type === 's') rawScores.stress += score;
            });
            return rawScores;
        }

        function renderDetailedScores(rawScores, finalScores, t) {
            const scoreBreakdown = document.getElementById('score-breakdown');
            scoreBreakdown.innerHTML = '';
            
            for (const type of ['depression', 'anxiety', 'stress']) {
                scoreBreakdown.innerHTML += `
                    <div class="score-detail">
                        <h4>${t[type]}</h4>
                        <div class="raw-score">${rawScores[type]}</div>
                        <div class="final-score">${t.finalScore}: ${finalScores[type]}</div>
                    </div>`;
            }
        }

        function renderScoringTable(t) {
            const tableBody = document.getElementById('scoring-table-body');
            const scoringRanges = [
                { severity: 'normal', depression: '0-9', anxiety: '0-7', stress: '0-14' },
                { severity: 'mild', depression: '10-13', anxiety: '8-9', stress: '15-18' },
                { severity: 'moderate', depression: '14-20', anxiety: '10-14', stress: '19-25' },
                { severity: 'severe', depression: '21-27', anxiety: '15-19', stress: '26-33' },
                { severity: 'extremelySevere', depression: '28+', anxiety: '20+', stress: '34+' }
            ];
            
            tableBody.innerHTML = '';
            scoringRanges.forEach(range => {
                tableBody.innerHTML += `
                    <tr>
                        <td class="severity-cell ${range.severity}">${t.severity[range.severity]}</td>
                        <td>${range.depression}</td>
                        <td>${range.anxiety}</td>
                        <td>${range.stress}</td>
                    </tr>`;
            });
        }
    </script>
</body>
</html>